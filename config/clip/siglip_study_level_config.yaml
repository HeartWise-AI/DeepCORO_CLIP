# SigLIP Training Config - Study-Level Report Alignment
#
# This config aligns each VIDEO with the FULL STUDY REPORT (not individual segments).
# Like the original base_config.yaml approach, but using reconstructed reports from segments.
#
# Key differences from segment-level (siglip_ddp_config.yaml):
# - target_label: Report (full study report)
# - Each video matches ONE study-level text
# - Weighting at study level (1.0=normal, 1.5=mild, 2.0=moderate, 3.0=severe/critical)
#
pipeline_project: !!str "DeepCORO_clip_study_level"
base_checkpoint_path: !!str outputs

# Training parameters
epochs: !!int 30
num_workers: !!int 16
debug: !!bool false
use_amp: !!bool true
period: !!int 1
run_mode: !!str train

# Dataset parameters - Study-level format (simple CSV like base_config.yaml)
data_filename: !!str output_dataset/siglip_study_level/dataset_with_reports.csv
root: !!str "."
target_label: !!str Report
datapoint_loc_label: !!str FileName
frames: !!int 16
stride: !!int 2
aggregate_videos_tokens: !!bool true
per_video_pool: !!bool false
multi_video: !!bool false
num_videos: !!int 1
groupby_column: !!str StudyInstanceUID
shuffle_videos: !!bool true
batch_size: !!int 24

# Seed
seed: !!int 42

# Model parameters
model_name: !!str mvit
pretrained: !!bool true

# Optimizer parameters
optimizer: !!str AdamW
scheduler_name: !!str cosine
lr: !!float 0.00006
lr_step_period: !!int 20
factor: !!float 0.45

# Loss - Standard contrastive (not SigLIP multi-positive)
# Since each video has ONE report, we use standard contrastive
loss_name: !!str contrastive

# Weight decay
video_weight_decay: !!float 6.5e-6
text_weight_decay: !!float 8.0e-7
gradient_accumulation_steps: !!int 1
num_warmup_percent: !!float 0.1
num_hard_restarts_cycles: !!float 1.0
warm_restart_tmult: !!int 2
max_grad_norm: !!float 1.0

# Model architecture parameters
num_heads: !!int 8
aggregator_depth: !!int 2
temperature: !!float 0.06
dropout: !!float 0.15
video_freeze_ratio: !!float 0.87
text_freeze_ratio: !!float 0.92

# Checkpointing
resume_training: !!bool false
checkpoint: !!str ""
output_dir: !!str outputs
save_best: !!str loss

# Metrics - Recall @k
recall_k: [1, 5, 10, 50]
ndcg_k: [5]

# Data augmentation
rand_augment: !!bool true
resize: !!int 224
apply_mask: !!bool false

# wandb parameters
tag: !!str mvit_study_level
name: !!str DeepCORO_Clip_Study_Level_Report
project: !!str DeepCORO_Clip_Study_Level
entity: !!str mhi_ai
use_wandb: !!bool true

# Inference parameters
topk: !!int 5
text_embeddings_path: !!str ""
metadata_path: !!str ""
inference_results_path: !!str checkpoints/inference/
